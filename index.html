<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë©”ëœíŒŒí‹°ì¡´</title>
  <style>
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
      background-color: #121212;
      color: #fff;
    }
    header {
      text-align: center;
      padding: 15px;
      background: #1e1e1e;
      font-size: 1.8em;
      font-weight: bold;
      color: #fff;
      border-bottom: 2px solid #333;
    }
    .login {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 0.9em;
    }
    .login button {
      background: #5865F2;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
    }
    .worlds {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      background: #181818;
      padding: 10px 0;
      gap: 10px;
    }
    .world {
      cursor: pointer;
      text-align: center;
      transition: transform 0.2s ease;
    }
    .world img {
      width: 120px;
      height: 80px;
      object-fit: cover;
      border-radius: 10px;
      border: 2px solid #444;
    }
    .world span {
      display: block;
      margin-top: 5px;
      color: #ddd;
      font-weight: 500;
    }
    .world:hover { transform: scale(1.05); }
    .content { display: flex; max-width: 1200px; margin: 20px auto; gap: 20px; }
    .board, .chat { flex: 1; background: #1a1a1a; border-radius: 10px; padding: 20px; }
    .board { flex: 2; }
    .tabs { display: flex; justify-content: center; gap: 8px; margin-top: 20px; }
    .tab { background: #2b2b2b; color: #aaa; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 0.9em; }
    .tab.active { background: #5c9ded; color: #fff; }
    input, textarea {
      width: 100%;
      background: #222;
      border: 1px solid #444;
      border-radius: 6px;
      color: white;
      padding: 8px;
    }
    button { background: #5c9ded; border: none; color: #fff; border-radius: 6px; padding: 8px 14px; margin-top: 5px; cursor: pointer; }
    button:hover { background: #4a8dd8; }
    .post { background: #222; padding: 10px; border-radius: 6px; margin-bottom: 10px; }
    .post h4 { margin: 0; }
  </style>
</head>
<body>
  <header>ë©”ëœíŒŒí‹°ì¡´ <span class="login" id="loginArea"><button onclick="loginWithDiscord()">ë””ìŠ¤ì½”ë“œ ë¡œê·¸ì¸</button></span></header>

<!-- í—¤ë”ë‚˜ ì˜¤ë¥¸ìª½ ìƒë‹¨ ì˜ì—­ -->
<div id="loginArea" style="position:absolute; top:20px; right:20px;">
  <button onclick="loginWithDiscord()" 
          style="background:#5865F2; color:white; border:none; padding:8px 14px; border-radius:6px; cursor:pointer;">
    ë””ìŠ¤ì½”ë“œ ë¡œê·¸ì¸
  </button>
</div>

<script>
const CLIENT_ID = "1424448769113456752";
const REDIRECT_URI = "https://miniming2-ui.github.io/maple-partyzone7/";
const OAUTH_SCOPE = "identify";

function loginWithDiscord() {
  const url = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${OAUTH_SCOPE}`;
  window.location.href = url;
}

function handleDiscordLogin() {
  const hash = window.location.hash;
  if (hash.includes("access_token")) {
    const token = new URLSearchParams(hash.substring(1)).get("access_token");
    fetch("https://discord.com/api/users/@me", {
      headers: { Authorization: `Bearer ${token}` }
    })
    .then(res => res.json())
    .then(user => {
      document.getElementById("loginArea").innerHTML = `ğŸ‘¤ ${user.username}`;
      localStorage.setItem("discordUser", user.username);
      history.replaceState(null, "", REDIRECT_URI);
    })
    .catch(() => alert("ë””ìŠ¤ì½”ë“œ ë¡œê·¸ì¸ ì‹¤íŒ¨!"));
  } else {
    const saved = localStorage.getItem("discordUser");
    if (saved) document.getElementById("loginArea").innerHTML = `ğŸ‘¤ ${saved}`;
  }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ë¡œê·¸ì¸ ì²´í¬
window.onload = handleDiscordLogin;
</script>


  <div class="worlds" id="worlds">
    <div class="world" data-world="victoria"><img src="images/victoria.png"><span>ë¹…í† ë¦¬ì•„ ì•„ì¼ëœë“œ</span></div>
    <div class="world" data-world="elnath"><img src="images/elnath.png"><span>ì—˜ë‚˜ìŠ¤ ì‚°ë§¥</span></div>
    <div class="world" data-world="luduslake"><img src="images/luduslake.png"><span>ë£¨ë”ìŠ¤ í˜¸ìˆ˜</span></div>
    <div class="world" data-world="minar"><img src="images/minar.png"><span>ë¯¸ë‚˜ë¥´ ìˆ²</span></div>
    <div class="world" data-world="aqua"><img src="images/aqua.png"><span>ì•„ì¿ ì•„ë¦¬ì›€</span></div>
    <div class="world" data-world="nihal"><img src="images/nihal.png"><span>ë‹ˆí•  ì‚¬ë§‰</span></div>
  </div>

  <div class="tabs">
    <div class="tab active" data-level="all">ì „ì²´</div>
    <div class="tab" data-level="10-30">10~30</div>
    <div class="tab" data-level="30-50">30~50</div>
    <div class="tab" data-level="50-80">50~80</div>
    <div class="tab" data-level="80-100">80~100</div>
    <div class="tab" data-level="100-130">100~130</div>
    <div class="tab" data-level="130+">130 ì´ìƒ</div>
  </div>

  <div class="content">
    <div class="board">
      <h2>ëª¨ì§‘ ê²Œì‹œíŒ</h2>
      <input type="text" id="search" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
      <div id="posts"></div>
      <textarea id="postText" placeholder="ëª¨ì§‘ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
      <button onclick="addPost()">ê¸€ ë“±ë¡</button>
      <p id="cooldownMsg"></p>
    </div>
    <div class="chat">
      <h2>ì‹¤ì‹œê°„ ì±„íŒ…</h2>
      <div id="chatBox" style="height:250px; overflow-y:auto; background:#222; padding:10px; border-radius:6px;"></div>
      <input id="chatInput" placeholder="ë©”ì‹œì§€ ì…ë ¥..." />
      <button onclick="sendChat()">ì „ì†¡</button>
      <p id="chatCooldownMsg"></p>
    </div>
  </div>

<script>
const CLIENT_ID = "1424448769113456752";
const REDIRECT_URI = "https://miniming2-ui.github.io/maple-partyzone7/";
const OAUTH_SCOPE = "identify";

function loginWithDiscord() {
  const url = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=${OAUTH_SCOPE}`;
  window.location.href = url;
}

function handleDiscordLogin() {
  const hash = window.location.hash;
  if (hash.includes("access_token")) {
    const token = new URLSearchParams(hash.substring(1)).get("access_token");
    fetch("https://discord.com/api/users/@me", {
      headers: { Authorization: `Bearer ${token}` }
    })
    .then(res => res.json())
    .then(user => {
      document.getElementById("loginArea").innerHTML = `ğŸ‘¤ ${user.username}`;
      localStorage.setItem("discordUser", user.username);
      history.replaceState(null, "", REDIRECT_URI);
    })
    .catch(() => alert("ë””ìŠ¤ì½”ë“œ ë¡œê·¸ì¸ ì‹¤íŒ¨!"));
  } else {
    const saved = localStorage.getItem("discordUser");
    if (saved) document.getElementById("loginArea").innerHTML = `ğŸ‘¤ ${saved}`;
  }
}
handleDiscordLogin();

let lastPostTime = 0;
let lastChatTime = 0;
let posts = [];
let worldFilter = "all";
let levelFilter = "all";

document.querySelectorAll('.world').forEach(w => {
  w.addEventListener('click', () => {
    worldFilter = w.dataset.world;
    renderPosts();
    history.pushState({ world: worldFilter }, "", "#" + worldFilter);
  });
});

window.addEventListener("popstate", (event) => {
  if (event.state && event.state.world) {
    worldFilter = event.state.world;
    renderPosts();
  } else {
    worldFilter = "all";
    renderPosts();
  }
});

document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    levelFilter = tab.dataset.level;
    renderPosts();
  });
});

function addPost() {
  const now = Date.now();
  if (now - lastPostTime < 180000) {
    document.getElementById('cooldownMsg').innerText = "ê²Œì‹œíŒ ì¿¨íƒ€ì„ 3ë¶„ì…ë‹ˆë‹¤!";
    return;
  }
  const text = document.getElementById('postText').value.trim();
  if (!text) return;
  posts.unshift({ text, world: worldFilter, level: levelFilter, time: new Date().toLocaleTimeString() });
  document.getElementById('postText').value = '';
  lastPostTime = now;
  renderPosts();
}

function renderPosts() {
  const list = document.getElementById('posts');
  const keyword = document.getElementById('search').value.toLowerCase();
  list.innerHTML = posts.filter(p =>
    (worldFilter === 'all' || p.world === worldFilter) &&
    (levelFilter === 'all' || p.level === levelFilter) &&
    p.text.toLowerCase().includes(keyword)
  ).map(p => `<div class="post"><h4>[${p.world}] ${p.text}</h4><small>${p.time}</small></div>`).join('');
}
document.getElementById('search').addEventListener('input', renderPosts);

function sendChat() {
  const now = Date.now();
  if (now - lastChatTime < 60000) {
    document.getElementById('chatCooldownMsg').innerText = "ì±„íŒ… ì¿¨íƒ€ì„ 1ë¶„ì…ë‹ˆë‹¤!";
    return;
  }
  const input = document.getElementById('chatInput');
  const msg = input.value.trim();
  if (!msg) return;
  const chatBox = document.getElementById('chatBox');
  chatBox.innerHTML += `<div>ğŸ’¬ ${msg}</div>`;
  chatBox.scrollTop = chatBox.scrollHeight;
  input.value = '';
  lastChatTime = now;
}
</script>
<script>
  const worldButtons = document.querySelectorAll('.world-btn');
  let currentWorld = null;

  // ëŒ€ë¥™ í´ë¦­ ì‹œ URL ë³€ê²½ + ìƒíƒœ ì €ì¥
  worldButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      currentWorld = btn.dataset.world;
      showWorldPosts(currentWorld);

      // ì£¼ì†Œì— í•´ì‹œ ì¶”ê°€
      history.pushState({ world: currentWorld }, '', '#' + currentWorld);
    });
  });

  // ë’¤ë¡œê°€ê¸°/ì•ìœ¼ë¡œê°€ê¸° ê°ì§€
  window.addEventListener('popstate', (event) => {
    if (event.state && event.state.world) {
      // íŠ¹ì • ëŒ€ë¥™ ë³µê·€
      showWorldPosts(event.state.world);
    } else {
      // ê¸°ë³¸ ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
      showMainView();
    }
  });

  // í˜ì´ì§€ ì²˜ìŒ ë¡œë“œë  ë•Œ í•´ì‹œê°€ ìˆìœ¼ë©´ ìë™ ì´ë™
  window.addEventListener('load', () => {
    const hash = window.location.hash.replace('#', '');
    if (hash) showWorldPosts(hash);
  });

  // ì˜ˆì‹œìš© í•¨ìˆ˜ (ì‹¤ì œ ë„¤ ì½”ë“œì— ë§ê²Œ êµì²´)
  function showWorldPosts(world) {
    document.querySelector('#main-section').style.display = 'none';
    document.querySelector(`#${world}-section`).style.display = 'block';
  }

  function showMainView() {
    document.querySelectorAll('.world-section').forEach(sec => sec.style.display = 'none');
    document.querySelector('#main-section').style.display = 'block';
  }
</script>
</body>
</html>
